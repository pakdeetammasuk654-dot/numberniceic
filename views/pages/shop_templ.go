// Code generated by templ - DO NOT EDIT.

// templ: version: v0.3.960
package pages

//lint:file-ignore SA4006 This context is only used if a nested component is present.

import "github.com/a-h/templ"
import templruntime "github.com/a-h/templ/runtime"

func Shop() templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var1 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var1 == nil {
			templ_7745c5c3_Var1 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 1, "<div style=\"font-family: 'Kanit', sans-serif; max-width: 800px; margin: 0 auto; padding: 2rem 1rem;\"><div style=\"text-align: center; margin-bottom: 3rem;\"><h1 style=\"font-size: 2.5rem; color: #2d3748; margin-bottom: 1rem;\">ร้านค้ามงคล</h1><p style=\"font-size: 1.1rem; color: #718096;\">เลือกซื้อสิ่งของมงคลเพื่อเสริมดวง และรับรหัส VIP สำหรับใช้งานในแอปฟรี!</p></div><!-- Product Grid Container --><div id=\"product-grid\" style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; min-height: 400px;\"><!-- Skeleton Loading State --><div class=\"skeleton-loader\" style=\"background: white; border-radius: 20px; height: 400px; box-shadow: 0 4px 6px rgba(0,0,0,0.05);\"></div><div class=\"skeleton-loader\" style=\"background: white; border-radius: 20px; height: 400px; box-shadow: 0 4px 6px rgba(0,0,0,0.05);\"></div></div><!-- Payment Modal --><div id=\"payment-modal\" style=\"display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; align-items: center; justify-content: center; padding: 1rem;\"><div style=\"background: white; padding: 0; border-radius: 24px; max-width: 450px; width: 100%; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.2);\"><div style=\"background: #2d3748; padding: 1.5rem; color: white;\"><h3 style=\"margin: 0; font-size: 1.25rem;\">ชำระเงิน</h3><p style=\"margin: 0.25rem 0 0; font-size: 0.9rem; opacity: 0.8;\">Ref No: <span id=\"pay-ref-no\" style=\"font-family: monospace;\">-</span></p></div><div style=\"padding: 2rem;\"><div style=\"text-align: center; margin-bottom: 2rem;\"><p style=\"color: #718096; margin-bottom: 1rem;\">กรุณาสแกน QR Code เพื่อชำระเงิน</p><div style=\"width: 200px; height: 200px; background: #f7fafc; margin: 0 auto 1rem; display: flex; align-items: center; justify-content: center; border: 1px solid #edf2f7; border-radius: 12px;\"><img id=\"qr-code-img\" src=\"\" alt=\"PromptPay QR\" style=\"width: 100%; height: 100%; object-fit: contain; border-radius: 12px;\"></div><h2 id=\"pay-amount\" style=\"font-size: 2rem; color: #2d3748; font-weight: bold; margin: 0;\">0.00 ฿</h2><p style=\"margin-top: 0.5rem; color: #e53e3e; font-weight: bold;\">ชำระภายใน <span id=\"payment-timer\">10:00</span> นาที</p></div><div style=\"margin-bottom: 1.5rem; text-align: center;\"><!-- Polling Status Overlay --><div id=\"payment-status-container\" style=\"color: #4a5568;\"><div class=\"spinner\" style=\"margin: 0 auto 1rem; width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite;\"></div><p style=\"font-weight: bold;\">กำลังรอการชำระเงิน...</p><p style=\"font-size: 0.85rem; color: #718096;\">ระบบจะตรวจสอบยอดเงินอัตโนมัติ</p></div></div><button onclick=\"window.closePaymentModal()\" style=\"width: 100%; background: transparent; color: #718096; border: none; padding: 1rem; margin-top: 0.5rem; font-family: 'Kanit', sans-serif; cursor: pointer;\">ยกเลิก</button></div></div></div><!-- Success Modal --><div id=\"shop-modal\" style=\"display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1001; align-items: center; justify-content: center; padding: 1rem;\"><div style=\"background: white; padding: 2.5rem; border-radius: 24px; max-width: 450px; width: 100%; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.2);\"><div style=\"width: 70px; height: 70px; background: #2da44e; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"40\" height=\"40\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><polyline points=\"20 6 9 17 4 12\"></polyline></svg></div><h2 style=\"font-size: 1.75rem; color: #2d3748; margin-bottom: 0.5rem;\">ชำระเงินสำเร็จ!</h2><p style=\"color: #718096; margin-bottom: 2rem;\">ขอบคุณสำหรับการสั่งซื้อ</p><div style=\"background: #f7fafc; border: 2px dashed #cbd5e0; padding: 1.5rem; border-radius: 16px; margin-bottom: 2rem;\"><p style=\"font-size: 0.85rem; color: #718096; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 1px;\">รหัส VIP ของคุณคือ</p><h3 id=\"modal-promo-code\" style=\"font-size: 2rem; color: #2d3748; font-family: monospace; letter-spacing: 2px; margin: 0;\">--------</h3></div><p id=\"shop-modal-desc\" style=\"font-size: 0.9rem; color: #718096; margin-bottom: 2rem;\">*รหัสนี้ถูกบันทึกในประวัติการสั่งซื้อของคุณแล้ว</p><button onclick=\"window.closeShopModal()\" style=\"width: 100%; background: #edf2f7; color: #4a5568; border: none; padding: 1rem; border-radius: 12px; font-weight: bold; font-family: 'Kanit', sans-serif; cursor: pointer;\">ปิดหน้าต่าง</button></div></div><style>\n\t\t\t@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }\n\t\t</style><script>\n\t\t\t// Helper functions (Global Scope - attached to window)\n\t\t\twindow.pollInterval = null;\n\t\t\twindow.timerInterval = null;\n\n\t\t\twindow.startTimer = function(duration, display) {\n\t\t\t\tvar timer = duration, minutes, seconds;\n\t\t\t\tif (window.timerInterval) clearInterval(window.timerInterval);\n\n\t\t\t\twindow.timerInterval = setInterval(function () {\n\t\t\t\t\tminutes = parseInt(timer / 60, 10);\n\t\t\t\t\tseconds = parseInt(timer % 60, 10);\n\n\t\t\t\t\tminutes = minutes < 10 ? \"0\" + minutes : minutes;\n\t\t\t\t\tseconds = seconds < 10 ? \"0\" + seconds : seconds;\n\n\t\t\t\t\tdisplay.textContent = minutes + \":\" + seconds;\n\n\t\t\t\t\tif (--timer < 0) {\n\t\t\t\t\t\tclearInterval(window.timerInterval);\n\t\t\t\t\t\talert(\"หมดเวลาทำรายการ กรุณาทำรายการใหม่\");\n\t\t\t\t\t\twindow.closePaymentModal();\n\t\t\t\t\t}\n\t\t\t\t}, 1000);\n\t\t\t};\n\n\t\t\twindow.initiatePurchase = async function(productName) {\n\t\t\t\tconsole.log(\"Initiating purchase for:\", productName);\n\t\t\t\t// 1. Create Order via API\n\t\t\t\ttry {\n\t\t\t\t\tconst res = await fetch('/api/shop/order', {\n\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\theaders: { 'Content-Type': 'application/json' },\n\t\t\t\t\t\tbody: JSON.stringify({ product_name: productName })\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tif (res.status === 401) {\n\t\t\t\t\t\twindow.location.href = '/login';\n                        return;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!res.ok) {\n\t\t\t\t\t\tconst errData = await res.json();\n\t\t\t\t\t\tthrow new Error(errData.error || 'Create order failed');\n\t\t\t\t\t}\n\t\t\t\t\tconst data = await res.json();\n\t\t\t\t\tconsole.log(\"Order created:\", data);\n\n\t\t\t\t\t// 2. Show Payment Modal\n\t\t\t\t\twindow.currentRefNo = data.ref_no;\n\t\t\t\t\tdocument.getElementById('pay-ref-no').innerText = data.ref_no;\n\t\t\t\t\tdocument.getElementById('pay-amount').innerText = data.amount.toLocaleString() + ' ฿';\n\t\t\t\t\t\n\t\t\t\t\t// Handle PaySolutions QR\n\t\t\t\t\tconst qrImg = document.getElementById('qr-code-img');\n\t\t\t\t\tif (data.qr_code_url) {\n\t\t\t\t\t\tqrImg.src = data.qr_code_url;\n\t\t\t\t\t\tqrImg.style.display = 'block';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tqrImg.style.display = 'none';\n\t\t\t\t\t\talert('QR Code ไม่สามารถใช้งานได้ในขณะนี้');\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tdocument.getElementById('payment-modal').style.display = 'flex';\n\n\t\t\t\t\t// 3. Start Polling & Timer (10 mins = 600s)\n\t\t\t\t\twindow.startPolling(data.ref_no);\n\t\t\t\t\twindow.startTimer(600, document.getElementById('payment-timer'));\n\n\t\t\t\t} catch (e) {\n\t\t\t\t\talert('เกิดข้อผิดพลาด: ' + e.message);\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\twindow.startPolling = function(refNo) {\n\t\t\t\tif (window.pollInterval) clearInterval(window.pollInterval);\n\t\t\t\t\n\t\t\t\twindow.pollInterval = setInterval(async () => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst res = await fetch('/api/shop/status/' + refNo);\n\t\t\t\t\t\tif (res.ok) {\n\t\t\t\t\t\t\tconst data = await res.json();\n\t\t\t\t\t\t\tif (data.paid) {\n\t\t\t\t\t\t\t\tclearInterval(window.pollInterval);\n\t\t\t\t\t\t\t\twindow.closePaymentModal();\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// Show Success\n\t\t\t\t\t\t\t\tdocument.getElementById('modal-promo-code').innerText = data.vip_code || 'VIP-ACTIVATED';\n\t\t\t\t\t\t\t\tdocument.getElementById('shop-modal').style.display = 'flex';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tconsole.error(\"Polling error\", e);\n\t\t\t\t\t}\n\t\t\t\t}, 3000); // Check every 3 seconds\n\t\t\t};\n\n\t\t\twindow.closePaymentModal = function() {\n\t\t\t\tdocument.getElementById('payment-modal').style.display = 'none';\n\t\t\t\twindow.currentRefNo = '';\n\t\t\t\tif (window.pollInterval) {\n\t\t\t\t\tclearInterval(window.pollInterval);\n\t\t\t\t\twindow.pollInterval = null;\n\t\t\t\t}\n\t\t\t\tif (window.timerInterval) {\n\t\t\t\t\tclearInterval(window.timerInterval);\n\t\t\t\t\twindow.timerInterval = null;\n\t\t\t\t}\n\t\t\t};\n\t\t\t\n\t\t\twindow.closeShopModal = function() {\n\t\t\t\tdocument.getElementById('shop-modal').style.display = 'none';\n                // Optional: Redirect to Dashboard?\n\t\t\t};\n\n\n\n\t\t\t// Load products on page load\n\t\t\tdocument.addEventListener('DOMContentLoaded', async () => {\n\t\t\t\tconst grid = document.getElementById('product-grid');\n\t\t\t\ttry {\n\t\t\t\t\tconst res = await fetch('/api/shop/products');\n\t\t\t\t\tif (!res.ok) throw new Error('Failed to load products');\n\t\t\t\t\tconst products = await res.json();\n\t\t\t\t\t\n\t\t\t\t\tgrid.innerHTML = '';\n\t\t\t\t\t\n\t\t\t\t\tif (products.length === 0) {\n\t\t\t\t\t\tgrid.innerHTML = '<p style=\"text-align:center; grid-column: 1/-1;\">ไม่พบสินค้าในขณะนี้</p>';\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tproducts.forEach(p => {\n\t\t\t\t\t\tconst card = document.createElement('div');\n\t\t\t\t\t\tcard.style.cssText = \"background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 25px rgba(0,0,0,0.05); border: 1px solid #edf2f7; transition: transform 0.3s ease;\";\n\t\t\t\t\t\t\n\t\t\t\t\t\tlet imageHtml = '';\n\t\t\t\t\t\tif (p.image_path && p.image_path.trim() !== '') {\n\t\t\t\t\t\t\t// Use uploaded image\n\t\t\t\t\t\t\timageHtml = `<img src=\"${p.image_path}\" alt=\"${p.name}\" style=\"width: 100%; height: 200px; object-fit: cover; display: block;\">`;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Legacy Fallback\n\t\t\t\t\t\t\tlet iconSvg = '';\n\t\t\t\t\t\t\tif (p.icon_type === 'bracelet') {\n\t\t\t\t\t\t\t\ticonSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"80\" height=\"80\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"white\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z\"/></svg>';\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\ticonSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"80\" height=\"80\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"white\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><circle cx=\"12\" cy=\"12\" r=\"10\"/><path d=\"M12 8a4 4 0 1 0 0 8 4 4 0 0 0 0-8z\"/></svg>';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\timageHtml = `\n\t\t\t\t\t\t\t\t<div style=\"height: 200px; background: linear-gradient(135deg, ${p.image_color_1 || '#ddd'} 0%, ${p.image_color_2 || '#999'} 100%); display: flex; align-items: center; justify-content: center;\">\n\t\t\t\t\t\t\t\t\t${iconSvg}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcard.innerHTML = `\n\t\t\t\t\t\t\t${imageHtml}\n\t\t\t\t\t\t\t<div style=\"padding: 1.5rem;\">\n\t\t\t\t\t\t\t\t<h3 style=\"font-size: 1.5rem; color: #2d3748; margin-bottom: 0.5rem;\">${p.name}</h3>\n\t\t\t\t\t\t\t\t<p style=\"color: #718096; font-size: 0.95rem; margin-bottom: 1.5rem;\">${p.description}</p>\n\t\t\t\t\t\t\t\t<div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;\">\n\t\t\t\t\t\t\t\t\t<span style=\"font-size: 1.75rem; font-weight: bold; color: #2da44e;\">${p.price.toLocaleString()} ฿</span>\n\t\t\t\t\t\t\t\t\t<span style=\"background: #ebf8ff; color: #2b6cb0; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.8rem; font-weight: bold;\">แถมฟรี VIP Lifetime</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<button \n\t\t\t\t\t\t\t\t\tonclick=\"window.initiatePurchase('${p.name}')\"\n\t\t\t\t\t\t\t\t\tclass=\"btn-buy\"\n\t\t\t\t\t\t\t\t\tstyle=\"width: 100%; background: #2d3748; color: white; border: none; padding: 1rem; border-radius: 12px; font-weight: bold; font-family: 'Kanit', sans-serif; cursor: pointer; transition: background 0.2s;\"\n\t\t\t\t\t\t\t\t\tonmouseover=\"this.style.background='#4a5568'\"\n\t\t\t\t\t\t\t\t\tonmouseout=\"this.style.background='#2d3748'\"\n\t\t\t\t\t\t\t\t>สั่งซื้อตอนนี้</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`;\n\t\t\t\t\t\tgrid.appendChild(card);\n\t\t\t\t\t});\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t\tgrid.innerHTML = '<p style=\"text-align:center; color:red; grid-column: 1/-1;\">เกิดข้อผิดพลาดในการโหลดสินค้า</p>';\n\t\t\t\t}\n\t\t\t});\n\t\t</script></div>")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		return nil
	})
}

var _ = templruntime.GeneratedTemplate
