<style>
    .sun-name {
        font-size: 1.2rem; /* Increased font size */
    }
    .score-analysis-grid {
        margin-top: 0; /* Reduced top margin */
    }
</style>
<!-- Solar System Animation -->
<div class="solar-system-container solar-bubble">
    <div class="solar-system">
        <div class="{{if .is_sun_dead}}sun sun-dead{{else}}sun{{end}}">
            <div class="sun-name">
                {{range .display_chars}}{{if .IsBad}}<span class="klakini-char">{{.Char}}</span>{{else}}<span>{{.Char}}</span>{{end}}{{end}}
            </div>
        </div>
        <div class="orbit orbit-inner"></div>
        <div class="orbit orbit-outer"></div>
        {{ $numCount := len .numerology_pairs }}
        {{ range $i, $pair := .numerology_pairs }}
            {{ $delay := mul $i (div 20.0 $numCount) }}
            <div class="planet-container orbit-inner" style="animation-delay: -{{ $delay }}s;">
                <div class="planet" style="background-color: {{.Meaning.Color}}; animation-delay: -{{ $delay }}s;" title="{{.Meaning.MiracleDesc}}">
                    {{.PairNumber}}
                </div>
            </div>
        {{ end }}
        {{ $shaCount := len .shadow_pairs }}
        {{ range $i, $pair := .shadow_pairs }}
            {{ $delay := mul $i (div 30.0 $shaCount) }}
            <div class="planet-container orbit-outer" style="animation-delay: -{{ $delay }}s;">
                <div class="planet" style="background-color: {{.Meaning.Color}}; animation-delay: -{{ $delay }}s;" title="{{.Meaning.MiracleDesc}}">
                    {{.PairNumber}}
                </div>
            </div>
        {{ end }}
    </div>
</div>

<!-- Single, Consolidated Result Card -->
<div class="result-box" style="padding-top: 0.5rem; padding-bottom: 0.5rem;">
    <!-- Sub-Header: Birthday & Klakini -->
    <div class="info-grid" style="padding-bottom: 0.5rem; margin-bottom: 0;">
        <div style="text-align: center;">
            <strong>วันเกิด:</strong> {{ .input_day }}
        </div>
        <div style="text-align: center;">
            <strong>กาลกิณี:</strong>
            {{if .klakini_characters}}
                <span class="icon-bad">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                    <span class="klakini">{{range .klakini_characters}}{{.}} {{end}}</span>
                </span>
            {{else}}
                <span class="icon-good">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                    ไม่พบ
                </span>
            {{end}}
        </div>
    </div>

    <!-- Simplified Score Summary -->
    <div class="info-grid" style="margin-top: 0; margin-bottom: 0; justify-content: space-around; border-top: 1px solid #eee; padding-top: 0.5rem;">
        <div class="score-values">
            <span class="score-good">ดี: +{{ add .num_positive_score .sha_positive_score }}</span>
        </div>
        <div class="score-values">
            <span class="score-bad">ร้าย: {{ add .num_negative_score .sha_negative_score }}</span>
        </div>
        <div class="grand-total-summary" style="margin-top: 0;">
            <strong>คะแนนรวม:</strong>
            <span class="{{if lt .grand_total_score 0}}score-bad{{else}}score-good{{end}}">
                {{if gt .grand_total_score 0}}+{{end}}{{.grand_total_score}}
            </span>
        </div>
    </div>
    <div class="action-links-container">
        <button type="button" class="link-button" onclick="document.getElementById('meaning-modal-{{.cleaned_name}}').style.display='flex'">
            ดูความหมายคู่เลข
        </button>
        <button type="button" class="link-button"
                hx-get="/linguistic-analysis?name={{.cleaned_name}}"
                hx-target="#linguistic-modal-content"
                hx-swap="innerHTML"
                hx-indicator="#linguistic-loading-{{.cleaned_name}}"
                onclick="document.getElementById('linguistic-modal-container-{{.cleaned_name}}').style.display='flex'">
            วิเคราะห์ชื่อตามรากศัพท์
        </button>
    </div>
</div>

<!-- Similar Names Section -->
<div class="similar-names-container">
    <div class="speech-bubble-header">
        <div class="header-text-content">
            <div class="header-main-line">
                <span class="header-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>
                </span>
                <span>
                    {{if .is_auspicious}}
                        รายชื่อมงคลของ "{{range .display_chars}}{{if .IsBad}}<span class="klakini-char">{{.Char}}</span>{{else}}<span>{{.Char}}</span>{{end}}{{end}}"
                    {{else}}
                        ตารางคล้าย "{{range .display_chars}}{{if .IsBad}}<span class="klakini-char">{{.Char}}</span>{{else}}<span>{{.Char}}</span>{{end}}{{end}}" ที่ไม่มีกาลกิณี
                    {{end}}
                </span>
            </div>
            {{if not .is_auspicious}}
            <div class="header-sub-line">
                <span class="icon-good" style="font-size: 0.8rem; font-weight: normal;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                    ไม่มีกาลกิณี
                </span>
            </div>
            {{end}}
        </div>

        <div class="toggle-switch-container">
            <span style="font-size: 0.8rem; margin-right: 0.5rem; font-weight: normal;">เฉพาะชื่อมงคล</span>
            <label class="toggle-switch">
                <input type="checkbox" name="auspicious" value="true" {{if .is_auspicious}}checked{{end}}
                       hx-get="/decode"
                       hx-target="#results"
                       hx-include="#name-form, [name='auspicious']"
                       hx-indicator="#spinner">
                <span class="slider"></span>
            </label>
        </div>
    </div>

    <table class="similar-names-table">
        <thead>
            <tr>
                <th>ชื่อ</th>
                <th>เลขศาสตร์</th>
                <th>พลังเงา</th>
                <th>คะแนนรวม</th>
                <th></th> <!-- Action Column -->
            </tr>
        </thead>
        <tbody>
            {{range $i, $name := .similar_names}}
            <tr class="{{if eq (mod $i 2) 0}}row-even{{else}}row-odd{{end}} clickable-row" onclick="selectName('{{$name.ThName}}')">
                <td>{{$name.ThName}}</td>
                <td>
                    <div class="table-pairs-container">
                        {{range $j, $pairInfo := $name.TSat}}
                            {{$pairNumber := index $name.SatNum $j}}
                            <span class="table-pair-circle" style="background-color: {{$pairInfo.Color}};">{{$pairNumber}}</span>
                        {{end}}
                    </div>
                </td>
                <td>
                    <div class="table-pairs-container">
                        {{range $j, $pairInfo := $name.TSha}}
                            {{$pairNumber := index $name.ShaNum $j}}
                            <span class="table-pair-circle" style="background-color: {{$pairInfo.Color}};">{{$pairNumber}}</span>
                        {{end}}
                    </div>
                </td>
                <td>
                    <span class="{{if lt $name.TotalScore 0}}score-bad{{else}}score-good{{end}}">
                        {{if gt $name.TotalScore 0}}+{{end}}{{$name.TotalScore}}
                    </span>
                </td>
                <td style="text-align: center;">
                    <span class="action-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                    </span>
                </td>
            </tr>
            {{else}}
            <tr>
                <td colspan="5" style="text-align: center;">ไม่พบชื่อที่ใกล้เคียง</td>
            </tr>
            {{end}}
        </tbody>
    </table>
</div>

<!-- Modal for Numerology Meanings -->
<div id="meaning-modal-{{.cleaned_name}}" class="modal-overlay" onclick="this.style.display='none'">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header">
            <h2>ความหมายคู่เลขของ "{{.cleaned_name}}"</h2>
            <button class="close-btn" onclick="document.getElementById('meaning-modal-{{.cleaned_name}}').style.display='none'">&times;</button>
        </div>
        <div class="modal-body">
            {{range .all_unique_pairs}}
            <div class="meaning-item">
                <div class="meaning-header">
                    <span class="pair-number-badge" style="background-color: {{.Meaning.Color}};">{{.PairNumber}}</span>
                    <span class="pair-desc">{{.Meaning.MiracleDesc}}</span>
                </div>
                <div class="meaning-content">
                    <p>{{.Meaning.MiracleDetail}}</p>
                </div>
            </div>
            {{else}}
            <p>ไม่พบข้อมูล</p>
            {{end}}
        </div>
    </div>
</div>

<!-- Modal for Linguistic Analysis -->
<div id="linguistic-modal-container-{{.cleaned_name}}" class="modal-overlay" onclick="this.style.display='none'">
    <div id="linguistic-modal-content" class="modal-content" onclick="event.stopPropagation()">
        <!-- Content will be loaded here by HTMX -->
        <div id="linguistic-loading-{{.cleaned_name}}" class="htmx-indicator" style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 200px;">
            <svg class="spinner" width="40px" height="40px" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg">
               <circle class="path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle>
            </svg>
            <p style="margin-top: 1rem; color: #666;">รอสักครู่ ระบบกำลังค้นหารากศัพท์ชื่อ... '{{.cleaned_name}}'</p>
        </div>
    </div>
</div>
