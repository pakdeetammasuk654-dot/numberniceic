<!-- The form is just a container, no HTMX attributes here -->
<form id="name-form">
    <div class="form-group">
        <label for="name">ชื่อ-นามสกุล</label>
        <div class="input-wrapper">
            <span class="input-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            </span>
            <input type="text" id="name" name="name" required placeholder="พิมพ์ชื่อเพื่อวิเคราะห์ทันที..." value="{{ .defaultName }}"
                   oninput="toggleClearButton()"
                   hx-get="/decode"
                   hx-target="#results"
                   hx-include="#name-form"
                   hx-trigger="input changed delay:500ms, load"
                   hx-indicator="#spinner">
            <span id="clear-btn" class="clear-btn" onclick="clearName()">×</span>
        </div>
        <small class="helper-text">ระบบจะวิเคราะห์ชื่อของคุณโดยอัตโนมัติขณะพิมพ์</small>
    </div>
    <div class="form-group">
        <label for="day">วันเกิด</label>
        <div class="input-wrapper">
            <span class="input-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>
            </span>
            <select id="day" name="day" required
                    hx-get="/decode"
                    hx-target="#results"
                    hx-include="#name-form"
                    hx-trigger="change"
                    hx-indicator="#spinner">
                <option value="SUNDAY" {{if eq .defaultDay "SUNDAY"}}selected{{end}}>วันอาทิตย์</option>
                <option value="MONDAY" {{if eq .defaultDay "MONDAY"}}selected{{end}}>วันจันทร์</option>
                <option value="TUESDAY" {{if eq .defaultDay "TUESDAY"}}selected{{end}}>วันอังคาร</option>
                <option value="WEDNESDAY1" {{if eq .defaultDay "WEDNESDAY1"}}selected{{end}}>วันพุธ (กลางวัน)</option>
                <option value="WEDNESDAY2" {{if eq .defaultDay "WEDNESDAY2"}}selected{{end}}>วันพุธ (กลางคืน)</option>
                <option value="THURSDAY" {{if eq .defaultDay "THURSDAY"}}selected{{end}}>วันพฤหัสบดี</option>
                <option value="FRIDAY" {{if eq .defaultDay "FRIDAY"}}selected{{end}}>วันศุกร์</option>
                <option value="SATURDAY" {{if eq .defaultDay "SATURDAY"}}selected{{end}}>วันเสาร์</option>
            </select>
        </div>
    </div>
</form>

<!-- Sample Names Section -->
<div class="sample-names-container">
    <div class="avatars-grid">
        {{range .sampleNames}}
            <div class="avatar-card" onclick="selectName('{{.Name}}')">
                <img src="{{.AvatarURL}}" alt="Avatar" class="avatar-img">
                <div class="avatar-name">{{.Name}}</div>
            </div>
        {{end}}
    </div>
</div>

<div id="spinner" class="htmx-indicator" style="margin-top: 1rem;">
    <p>กำลังประมวลผล...</p>
</div>

<!-- Results Section for initial load and as a target -->
<div id="results">
    <!-- The initial load is now handled by the input field itself -->
</div>

<!-- JavaScript -->
<script>
    function selectName(name) {
        const nameInput = document.getElementById('name');
        nameInput.value = name;
        toggleClearButton();

        // Manually trigger the input event on the input field itself
        htmx.trigger('#name', 'input');

        // Scroll to the top of the form for better UX
        const form = document.getElementById('name-form');
        if (form) {
            form.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    }

    function toggleClearButton() {
        const nameInput = document.getElementById('name');
        const clearBtn = document.getElementById('clear-btn');
        if (nameInput && nameInput.value.length > 0) {
            clearBtn.style.display = 'block';
        } else if (clearBtn) {
            clearBtn.style.display = 'none';
        }
    }

    function clearName() {
        const nameInput = document.getElementById('name');
        nameInput.value = '';
        toggleClearButton();
        nameInput.focus();
        // Manually trigger the input event to clear the results via HTMX
        htmx.trigger('#name', 'input');
    }

    document.addEventListener('DOMContentLoaded', function() {
        toggleClearButton();
        // Trigger initial load from the input field
        htmx.trigger('#name', 'load');
    });
</script>
