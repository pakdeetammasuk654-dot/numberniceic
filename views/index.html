<h1>วิเคราะห์ชื่อตามหลักเลขศาสตร์</h1>
<p>กรอกชื่อและวันเกิดของคุณเพื่อเริ่มต้นการวิเคราะห์</p>

<!-- The form is just a container, no HTMX attributes here -->
<form id="name-form">
    <div class="form-group">
        <label for="name">ชื่อ-นามสกุล</label>
        <div class="input-wrapper">
            <!-- Input has its own complete set of HTMX attributes -->
            <input type="text" id="name" name="name" required placeholder="เช่น สมชาย ใจดี" value="{{ .defaultName }}"
                   oninput="toggleClearButton()"
                   hx-get="/decode"
                   hx-target="#results"
                   hx-include="#name-form"
                   hx-trigger="input delay:500ms"
                   hx-indicator="#spinner">
            <span id="clear-btn" class="clear-btn" onclick="clearName()">×</span>
        </div>
    </div>
    <div class="form-group">
        <label for="day">วันเกิด</label>
        <!-- Select has its own complete set of HTMX attributes -->
        <select id="day" name="day" required
                hx-get="/decode"
                hx-target="#results"
                hx-include="#name-form"
                hx-trigger="change"
                hx-indicator="#spinner">
            <option value="SUNDAY" {{if eq .defaultDay "SUNDAY"}}selected{{end}}>วันอาทิตย์</option>
            <option value="MONDAY" {{if eq .defaultDay "MONDAY"}}selected{{end}}>วันจันทร์</option>
            <option value="TUESDAY" {{if eq .defaultDay "TUESDAY"}}selected{{end}}>วันอังคาร</option>
            <option value="WEDNESDAY1" {{if eq .defaultDay "WEDNESDAY1"}}selected{{end}}>วันพุธ (กลางวัน)</option>
            <option value="WEDNESDAY2" {{if eq .defaultDay "WEDNESDAY2"}}selected{{end}}>วันพุธ (กลางคืน)</option>
            <option value="THURSDAY" {{if eq .defaultDay "THURSDAY"}}selected{{end}}>วันพฤหัสบดี</option>
            <option value="FRIDAY" {{if eq .defaultDay "FRIDAY"}}selected{{end}}>วันศุกร์</option>
            <option value="SATURDAY" {{if eq .defaultDay "SATURDAY"}}selected{{end}}>วันเสาร์</option>
        </select>
    </div>
    <div class="button-group">
        <!-- Buttons also have their own complete set of attributes -->
        <button
            id="decode-button"
            type="button"
            hx-get="/decode"
            hx-target="#results"
            hx-include="#name-form"
            hx-indicator="#spinner">
            วิเคราะห์ชื่อ
        </button>
        <button
            type="button"
            hx-get="/similar-names"
            hx-target="#results"
            hx-include="#name-form"
            hx-indicator="#spinner">
            ค้นหาชื่อใกล้เคียง
        </button>
        <button
            type="button"
            hx-get="/auspicious-names"
            hx-target="#results"
            hx-include="#name-form"
            hx-indicator="#spinner">
            ค้นหาชื่อมงคล
        </button>
    </div>
</form>

<hr class="content-divider">

<!-- Sample Names Section -->
<div class="sample-names-container">
    <div class="avatars-grid">
        {{range .sampleNames}}
            <div class="avatar-card" onclick="selectName('{{.Name}}')">
                <img src="{{.AvatarURL}}" alt="Avatar" class="avatar-img">
                <div class="avatar-name">{{.Name}}</div>
            </div>
        {{end}}
    </div>
</div>

<div id="spinner" class="htmx-indicator" style="margin-top: 1rem;">
    <p>กำลังประมวลผล...</p>
</div>

<!-- Results Section for initial load and as a target -->
<div id="results"
     hx-get="/decode"
     hx-trigger="load"
     hx-include="#name-form">

    <div id="spinner" style="margin-top: 1rem;">
        <p>กำลังโหลดข้อมูลเริ่มต้น...</p>
    </div>
</div>

<!-- JavaScript -->
<script>
    function selectName(name) {
        const nameInput = document.getElementById('name');
        nameInput.value = name;
        toggleClearButton();

        // Manually trigger the input event on the input field itself
        htmx.trigger('#name', 'input');

        const resultsDiv = document.getElementById('results');
        if (resultsDiv) {
            resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    }

    function toggleClearButton() {
        const nameInput = document.getElementById('name');
        const clearBtn = document.getElementById('clear-btn');
        if (nameInput && nameInput.value.length > 0) {
            clearBtn.style.display = 'block';
        } else if (clearBtn) {
            clearBtn.style.display = 'none';
        }
    }

    function clearName() {
        const nameInput = document.getElementById('name');
        nameInput.value = '';
        toggleClearButton();
        nameInput.focus();
        // Manually trigger the input event to clear the results via HTMX
        htmx.trigger('#name', 'input');
    }

    document.addEventListener('DOMContentLoaded', function() {
        toggleClearButton();
    });
</script>
